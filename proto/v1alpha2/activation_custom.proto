syntax = "proto3";

package ntt.watchdog.v1alpha2;

import "edgelq-sdk/iam/proto/v1alpha2/service_account_key.proto";
import "edgelq-sdk/meta/compilers/annotations/multi_region.proto";
import "watchdog-sdk/proto/v1alpha2/probe.proto";
import "watchdog-sdk/proto/v1alpha2/probe_change.proto";

option go_package = "github.com/cloudwan/watchdog-sdk/client/v1alpha2/activation;activation_client";
option java_multiple_files = false;
option java_outer_classname = "ActivationCustomProto";
option java_package = "com.ntt.watchdog.pb.v1alpha2";

// Request message for method [Activation][ntt.watchdog.v1alpha2.Activation]
message ActivationRequest {
  oneof msg {
    // onboard is sent by client. Depending on configured onboarding policy,
    // response may be immediate or take a long time (manual confirmation)
    Activate activate = 1;

    // ACK message is required to complete onboarding process
    ConfirmActivation confirm_activation = 2;
  }

  message Activate {
    // Token - either individual or shared
    string token = 1;

    // Random cookie string generated by client to identify its session
    string client_cookie = 2;

    // Optional probe data (required when using shared token).
    Probe probe = 3;

    // Additional key value pairs to be used to substitute placeholders of
    // the probe generation template.
    map<string, string> metadata = 4;
  }

  message ConfirmActivation {
    // Acknowledgment after receiving activation response.
    // Confirmation is required, otherwise received previously ServiceAccountKey
    // won't be usable
    string client_cookie = 1;
  }
}

// Response message for method [Activation][ntt.watchdog.v1alpha2.Activation]
message ActivationResponse {
  oneof msg {
    Activated activated = 1;

    // after receiving this message it's safe to close the onboarding stream
    ConfirmActivationAck confirm_activation_ack = 2;
  }

  message Activated {
    // Onboarded Probe resource
    Probe probe = 1;

    // ServiceAccountKey to use with PrivateKeyData
    ntt.iam.v1alpha2.ServiceAccountKey service_account_key = 2;
  }

  message ConfirmActivationAck {}
}

// Request message for method
// [SendActivationInvitation][ntt.watchdog.v1alpha2.SendActivationInvitation]
message SendActivationInvitationRequest { string name = 1; }

// Request message for method
// [ResetActivation][ntt.watchdog.v1alpha2.ResetActivation]
message ResetActivationRequest {
  // Target probe
  string name = 1;
}
